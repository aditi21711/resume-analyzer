from flask import Flask, request, jsonify
from flask_cors import CORS
import fitz  # PyMuPDF

app = Flask(__name__)
CORS(app)

@app.route('/analyze', methods=['POST'])
def analyze_resume():
    resume = request.files.get("resume")
    job_desc = request.form.get("job_desc")

    if not resume or not job_desc:
        return jsonify({"error": "Missing resume or job description"}), 400

    try:
        # Extract text from resume PDF
        resume_text = ""
        doc = fitz.open(stream=resume.read(), filetype="pdf")
        for page in doc:
            resume_text += page.get_text()

        # Simple keyword matching
        matched_keywords = []
        for word in job_desc.lower().split():
            if word in resume_text.lower():
                matched_keywords.append(word)

        if matched_keywords:
            feedback = f"✅ Resume matches the following job keywords: {', '.join(matched_keywords)}"
        else:
            feedback = "❌ No matching keywords found in the resume. Try tailoring it to the job description."

        return jsonify({"result": feedback})

    except Exception as e:
        return jsonify({"error": str(e)}), 500

if __name__ == '__main__':
    app.run(debug=True)
